@(address:Address)(proinfo:Product)(usr:User)(appid:String)(buycode:String)(addrSign:WxSign)(wxtoken:String)@views.html.sheSaid.main{<title>订单结算</title><script type="text/javascript" src="@assets.CdnAssets.urlForAPIPublic("javascripts/sheSaidJs/cityPanel/cityPanel.js")"></script><link rel="stylesheet" type="text/css" href="@assets.CdnAssets.urlForAPIPublic("stylesheets/sheSaidCSS/cityPanel/cityPanel.css")" media="all"><script src="@assets.CdnAssets.urlForAPIPublic("javascripts/sheSaidJs/alert.js")"></script><style>		    .certificates{				padding:6px 10px 10px;				}		 	.certificates b{				color:#ff314e;								font-size:12px;				font-weight:400;							}			.certificates p,.certificates input{				color:#303030;				font-size:13px;				line-height:28px;				border-radius:3px;				background:#e4e4e4;				padding:0 2%;				width:96%;				border:none;								}					.login-wrap{				position:absolute;				top:50%;				left:20px;				right:20px;				margin:-160px 0 0 0;				border-radius:6px;				background:#fff;				padding:30px;				box-shadow:0 0 3px #cacacd;						}			.login-wrap h2{				display:block;				text-align:center;				font-size:16px;				line-height:22px;				}				.login{				border-bottom:0;				}					.transparent{		      position: fixed;		      top:0;		      left:0;		      right:0;		      bottom:0;		      background:rgba(0,0,0,.5);		      }	  		       .person_input-wrap label{			    float:left;			    margin:0;			    padding:0;			    line-height:46px;			    width:50px;			   }			   .person_input-wrap p{			    margin-left:50px;			    } 			   .person_input{			    width:96%;			    text-overflow:ellipsis;			   } 	  	    	  	  	  	        </style>}{<div class="container"><form name="form1" id="form1" method="post" action="/sheSaid/saveOrder">		<input type="hidden" id="aid" name="aid" value="@if(address!=null){@address.getAddressId()}"/>		<input type="hidden" id="proid" name="proid" value="@proinfo.getPid()" />		<input type="hidden" id="uid" name="uid" value="@usr.getUid()" />		<input type="hidden" id="count" name="count" value="1" />				<div class="nav-top">               <p>订单结算</p>               <i class="ico-return" onclick="javascript:window.location.href='/H5/product?pid=@proinfo.getPid()';"></i>           	<i class="ico-basket" onclick="javascript:window.location.href='@assets.CdnAssets.H5_SHOPPING_URL("")'"></i>         </div>  		<!-- 选择微信地址 -->				<div class="address" id="wxaddress" name="wxaddress" onclick="selectwxaddress()" style="margin-top:5px;display:none">                <div class="address_info">                    <p class="name">                        <label id="wxname">@if(address.getName()==""){请填写收货人信息}else{@address.getName()}</label>                        <label id="wxphone">@if(address.getName()!=""){@address.getPhone()}</label>                    </p>                    <p class="txt" id="wxdress">                      @address.getProvince()@address.getAddress()                    </p>                </div>                <i class="ico_arrow_right"></i>            </div>		            <!-- 微信选择地址结束 -->         <div class="cont person" style="z-index:1000" id="showaddress" name="showaddress"> 			 <div class="person_input-wrap">			 <label>收货人信息</label>			 </div>              <div class="person_input-wrap">              <label>姓名：</label>				<p><input type="text" class="person_input" placeholder="收货人真实姓名" id="Name" name="Name"  value="@address.getName()"></p>              </div>              <div class="person_input-wrap">              <label>电话：</label>				<p><input type="tel" class="person_input" placeholder="手机号码" id="phone" name="phone" value="@address.getPhone()"></p>              </div>              <div class="person_input-wrap">              <label>地址：</label>				<p><input type="text" class="person_input city_dummy" name="city_dummy" id="city_dummy" placeholder="所在地区" value="@address.getProvince()" readOnly></p>                 <i class="ico_arrow_right city_dummy"></i>              </div>              <div class="person_input-wrap">             	<p><input type="text" class="person_input" placeholder="详细地址" id="address" name="address" value="@address.getAddress()"></p>              </div>                  	        	</div>@if(proinfo.getIsopenid()==1){			<div class="cont certificates">		              <b>应海关要求请填写真实身份证信息，以确保正常收货！</b>		              <input type="text" id="cardId" name="cardId" placeholder="身份证号" value="@address.getCardId()" />		    </div>		    }else{              <input type="hidden" id="cardId" name="cardId" value="@address.getCardId()" />              }  	<div class="cont product" style="margin-top:5px;">		<div class="product_img">			<img src="@proinfo.getListpic()" alt="@proinfo.getTitle()">		</div>		<div class="product_neme">@Html(proinfo.getTitle())</div>		<div class="product_info">			<span><i class="ico_number_cut" id="cut_class" style="cursor:hand" onclick="parsle()"></i><b id="parsnum">1</b><i				class="ico_number_add" id="add_class" style="cursor:hand" onclick="add()"></i></span> <em id="pricep">￥@if(proinfo.getRmbprice().toInt<proinfo.getRmbprice()){@proinfo.getRmbprice()}else{@proinfo.getRmbprice().toInt}</em>			<input type="hidden" id="price" name="price" value="@proinfo.getRmbprice()" />		</div>	</div>@if(proinfo.getPostfee()>0){	<div class="cont order_m">		<ul class="detail">			<li><span>结算明细</span> <em>订单总价：<b id="totalprice">￥@if((proinfo.getPostfee().toInt+proinfo.getRmbprice()).toInt<(proinfo.getPostfee().toInt+proinfo.getRmbprice()).toDouble){@(proinfo.getPostfee().toInt+proinfo.getRmbprice())}else{@((proinfo.getPostfee().toInt+proinfo.getRmbprice()).toInt)}</b></em></li>						<li>				<div>					<span>运费</span> <em id="postfee">￥@proinfo.getPostfee()</em>				</div>			</li>						<!--						<li>							<div>											<span>费税</span> <em>￥@proinfo.getCostPrice()</em>										</div>									</li>			-->		</ul>	</div>}<div class="cont-h115"></div>	<div class="cont fixed">		<div class="product_pay">			<p>				<em>合计:<b id="hjprice">￥@if((proinfo.getPostfee().toInt+proinfo.getRmbprice()).toInt<(proinfo.getPostfee().toInt+proinfo.getRmbprice()).toDouble){@(proinfo.getPostfee().toInt+proinfo.getRmbprice())}else{@((proinfo.getPostfee().toInt+proinfo.getRmbprice()).toInt)}</b></em>包含运费			</p>			<a href="#" class="btn btn_finish" id="onsubreg" onclick="submito()"><span id="innertxt">微信支付</span></a>		</div>	</div></form></div><div class="load" style='display: block;z-index:3000'></div><div class="transparent" id="showlogin" style="z-index:3000;display:none"><div class="container" id="showlogin" onclick=""><div class="login-wrap">	<h2>                  验证手机号<br>                  便于您按时收货    </h2>	<div class="login">		<form name="form1" id="form1" method="post" action="/api/checkUserVerify">		<input type="hidden" id="openid" name="openid" value="@usr.getOpenId()"/>		<input type="hidden" id="unionid" name="unionid" value="@usr.getUnionid()"/>		<input type="hidden" id="uid" name="uid" value="@usr.getUid()" />		<div class="input-wrap input-wrap-b">			<input type="text" id="phonereg" name="phonereg" class="input tel" placeholder="手机号">		</div>		<div class="input-wrap">			<input type="hidden" id="imgcheck" name="imgcheck" />			<input type="text" id="verify_sms" name="verify_sms" class="input letter" placeholder="短信验证码">			<a href="#" class="btn btn_code"><span id="sendsms" onclick="setDivCenter()">发送验证码</span></a>		</div>		</form>	</div>	<div class="protocol">		<p>			<i class="new_check"></i><a href="http://ht.neolix.cn/www/service/agreement.html">嗨个购用户协议</a>		</p>		<p>			<a href="#" class="btn btn_finish" onclick="checkuser()">完成</a>		</p>	</div>	<a href="javascript:;" class="pop-pay-close" onclick="closeshowlogin()"></a></div>	</div></div><div class="pop-code" id="showdiv" style="display:none">           <section>               <p>                 <img src='@assets.CdnAssets.urlForAPIPublic("images/H5/ico.png")' class="pop-code-ico"><br>                 请先输入图形上的字符               </p>               <div>                  <input type="text" id="imgh" name="imgh" class="pop-code-input" placeholder="输入图形验证码" />                  <img id="imgtmp" border="0" alt="点击图片可刷新" class="fr" style="margin-top:3px;*margin-top:-20px;" onclick="this.src='@routes.Application.imageValidate?temp='+ (new Date().getTime().toString(36));" src="@routes.Application.imageValidate?temp=h68w3wf2" id="validateImage"  />               </div>               <p onclick="closeDiv()">                  <a href="javascript:;" class="btn btn_finish">完成</a>               </p>           </section>        </div>}{<script>              $(function(){				 $(".city_dummy").cityPanel();			  }) </script><script type="text/javascript" src="@assets.CdnAssets.urlForAPIPublic("javascripts/sheSaidJs/noShareWX.js")"></script><script type="text/javascript"><!--function closeshowlogin(){	document.getElementById("showlogin").style.display="none";}var ua = window.navigator.userAgent.toLowerCase();var bw=false;if(ua.match(/MicroMessenger/i) == 'micromessenger'){	bw=true;	document.getElementById("showaddress").style.display="none";	document.getElementById("wxaddress").style.display="";	//document.getElementById("Name").value="";			//document.getElementById("phone").value="";			//document.getElementById("city_dummy").value="";			//document.getElementById("address").value="";}else{	bw=false;	document.getElementById("innertxt").innerHTML="支付宝支付";	document.getElementById("showaddress").style.display="";	document.getElementById("wxaddress").style.display="none";}//选择微信地址function selectwxaddress(){		@if(addrSign!=null && wxtoken!=""){		callpay();	}else{		window.location.href="/H5/wxauth_address?pid=@proinfo.getPid()&flg=pro";	}}/* * 调用微信地址JS */ function callpay() { 	if (typeof WeixinJSBridge == "undefined"){ 		if( document.addEventListener ){ 			document.addEventListener('WeixinJSBridgeReady', jsApiCall, false); 		}else if (document.attachEvent){ 			document.attachEvent('WeixinJSBridgeReady', jsApiCall);  			document.attachEvent('onWeixinJSBridgeReady', jsApiCall); 		} 	}else{ 		jsApiCall(); 	} } function jsApiCall() {	 @if(addrSign!=null){ 	WeixinJSBridge.invoke( 		'editAddress',{            "appId" : "@addrSign.getAppId()",     //公众号名称，由商户传入                 "scope":"jsapi_address",            "signType":"sha1",            "addrSign":"@addrSign.getSign()",            "timeStamp":"@addrSign.getTimstr()",         //时间戳，自1970年以来的秒数                 "nonceStr" : "@addrSign.getNostr()" //随机串           }, 		function(res){     	   //alert(res.err_msg); 			if(res.err_msg == "edit_address:ok" ) { 				//成功 				document.getElementById("Name").value=res.userName; 				//alert(document.getElementById("Name").value); 				document.getElementById("phone").value=res.telNumber; 				document.getElementById("city_dummy").value=res.addressCitySecondStageName+res.addressCountiesThirdStageName; 				document.getElementById("address").value=res.addressDetailInfo; 				document.getElementById("showaddress").style.display="none";	 				document.getElementById("wxdress").innerHTML=res.addressCitySecondStageName+res.addressCountiesThirdStageName+res.addressDetailInfo; 				document.getElementById("wxname").innerHTML=res.userName; 				document.getElementById("wxphone").innerHTML="<br>"+res.telNumber; 			}else{ 				//window.location.href="/H5/wxauth_address?pid=@proinfo.getPid()&flg=pro"; 				document.getElementById("showaddress").style.display=""; 				document.getElementById("wxaddress").style.display="none"; 			} 		} 	);	 } } /***********调用微信地址结束**********/var addressid='@address.getAddressId()';var asuc=false;var checkuserid='@usr.getUid()';function checkaddress(){	asuc=true;	 var reg = /^1\d{10}$/g; 	 if(!reg.test(document.getElementById("phone").value)){		 if(!bw)			 _alert("请输入正确的手机号!");		 else			 _alert("请选择地址");	 	asuc=false;	 	return false;	 }	 document.getElementById("phonereg").value=document.getElementById("phone").value;	if(document.getElementById("Name").value==""){		if(!bw)			_alert("请输入收货人!");		else			_alert("请选择地址");	 	asuc=false;	 	return false;	 }	if(document.getElementById("Name").value.length>16){		if(!bw)			_alert("收货人不能超过16个字符!");		else			_alert("请选择地址");	 	asuc=false;	 	return false;	 }	 if(document.getElementById("address").value==""){		 if(!bw)			 _alert("请输入详细地址!");		 else			 _alert("请选择地址");	 	asuc=false;	 	return false;	 }	 if(document.getElementById("address").value.length>100){		 if(!bw)			 _alert("详细地址不能超过100个字符!");		 else			 _alert("请选择地址");		 	asuc=false;		 	return false;	}	 	 if(document.getElementById("city_dummy").value==""){		 if(!bw)			 _alert("请输入所在地区!");		 else			 _alert("请选择地址");	 	asuc=false;	 	return false;	 }	 @if(proinfo.getIsopenid()==1){		 if(document.getElementById("cardId").value.length<15){			 _alert("请输入身份证号!");			 asuc=false;			 return false;		 }	 }}@if(usr.getUid()==0){		document.getElementById("onsubreg").onclick=function(){submitlogin();};}function submitlogin(){	checkaddress();	if(asuc)		document.getElementById("showlogin").style.display="";}$('.load').fadeOut("slow");	function submito(){	var aid="@if(address!=null){address.getAddressId()}";	if(bw)		aid="";	//alert("ok");		var aid=document.getElementById("aid").value;		var uid=document.getElementById("uid").value;		var pid='@proinfo.getPid()';		var nums=document.getElementById("count").value;		var datastr=pid+"_@proinfo.getRmbprice()_"+nums;		var suc=asuc;				if(aid.length<1 || uid.length<1 || pid.length<1){			_alert("请填写收货地址!");			suc=false;		}		@if(proinfo.getIsopenid()==1){			 if(document.getElementById("cardId").value.length<15){				 addressid=0;				 aid=0;				 _alert("请输入身份证号!");				 return false;			 }		}		checkaddress();			if(suc){			$('.load').fadeIn();			$.ajax({	            type:"POST",	            url:"/H5/saveaddress",	            data:{aid:addressid,uid:checkuserid,Name:document.getElementById("Name").value,phone:document.getElementById("phone").value,address:document.getElementById("address").value,city_dummy:document.getElementById("city_dummy").value,cardid:document.getElementById("cardId").value,pids:'@proinfo.getPid()'},	            datatype: "json",//"xml", "html", "script", "json", "jsonp", "text".	            beforeSend:function(){},  		           success:function(data){	        	   		         	if(data.status=="1"){			         		//alert("ok"+data.aid);		         		addressid=data.aid;			         							//如果0支付直接结单					var tf=document.getElementById("hjprice").innerHTML;					if(tf.length>1)						tf=tf.replace("￥","");										if(tf=="0"){						//alert("ok");						$.ajax({				            type:"POST",				            url:"/api/shoppingOrder_new",				            data:{datastr:datastr,uid:uid,addressid:addressid,typ:7,mcode:'@buycode'},				            datatype: "json",//"xml", "html", "script", "json", "jsonp", "text".				            beforeSend:function(){},				            success:function(data){				            	$('.load').fadeOut("slow");				          		if(data.orderId>0){					          			//alert(data.orderCode);				          			window.location.href="/H5/zeroturn?ordercode="+data.orderCode;				          							          		}else{				          			_alert("订购失败!");				          			$('.load').fadeOut("slow");				          		}				            },				            complete: function(XMLHttpRequest, textStatus){				            },				            error: function(){				                _alert("提示请检查一下网络!");				                $('.load').fadeOut("slow");				            }        				         });					}					else					{						if(bw){							$.ajax({				            type:"POST",				            url:"/api/shoppingOrder_new",				             data:{datastr:datastr,uid:uid,addressid:addressid,typ:7,mcode:'@buycode'},				            datatype: "json",//"xml", "html", "script", "json", "jsonp", "text".				            beforeSend:function(){},				            success:function(data){				            	$('.load').fadeOut("slow");				          		if(data.orderId>0){				          			$('.load').fadeOut("slow");				          			if(bw==true){				          				var u=encodeURI("http://api.higegou.com/H5/orderxpro?orderCode="+data.orderCode+"&uid=@usr.getUid()&pid=@proinfo.getPid()&aid="+aid);				          				window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=@appid&redirect_uri="+u+"&response_type=code&scope=snsapi_base&state=123&connect_redirect=1#wechat_redirect";				          			}				          			else				          				{					          				var u="/H5/orderxpro?orderCode="+data.orderCode+"&uid=@usr.getUid()&pid=@proinfo.getPid()&aid="+aid;						          			window.location.href=u;				          				}				          		}else{				          			$('.load').fadeOut("slow");				          			_alert(data.msg);				          		}				            },				            complete: function(XMLHttpRequest, textStatus){				            },				            error: function(){				            	$('.load').fadeOut("slow");				                _alert("提示请检查一下网络!");				            }        				         }); 							}					else					{						//支付宝支付操作						$.ajax({				            type:"POST",				            url:"/api/shoppingOrder_new",				            data:{datastr:datastr,uid:uid,addressid:addressid,typ:7,mcode:'@buycode'},				            datatype: "json",//"xml", "html", "script", "json", "jsonp", "text".				            beforeSend:function(){},				            success:function(data){				            	$('.load').fadeOut("slow");				            	//alert("生成订单:"+data.orderCode);				            	var backurl="http://182.92.227.140:9004/H5/alipayreturn";				          		if(data.orderId>0){					          			//alert(data.orderCode);				          			window.location.href="/H5/alipay?out_trade_no="+data.orderCode+"&total_fee="+data.totalfee+"&uid="+uid+"&pid=@proinfo.getPid()";				          			//var u="/api/alipaywapendorse?ordercode="+data.orderCode+"&amount=0.01&backurl="+backurl;																//window.location.href=u;									          		}else{				          			_alert("订购失败!");				          			$('.load').fadeOut("slow");				          		}				            },				            complete: function(XMLHttpRequest, textStatus){				            },				            error: function(){				            	$('.load').fadeOut("slow");				                _alert("处理失败!");				            }        				         }); 					}				}				         	}else{			        	 asuc=false;			        	_alert(data.msg); 			        	$('.load').fadeOut("slow");			         }		           },			       complete: function(XMLHttpRequest, textStatus){			       },			      error: function(){			    	  asuc=false;			        _alert("提示请检查一下网络!");				        $('.load').fadeOut("slow");			      } 			 });	}	 } var limitcount="@if(proinfo.getLimitcount()>proinfo.getNstock()){@proinfo.getNstock()}else{@proinfo.getLimitcount()}";  if(limitcount<2)	 $("#add_class").attr("class","ico_number_add ico_number_add_h");  function add(){  	var nums=document.getElementById("count").value;  	 	var endnum=(nums-1)+3-1; 	if(endnum>=limitcount){ 		endnum=limitcount; 		$("#add_class").attr("class","ico_number_add ico_number_add_h"); 	} 	document.getElementById("parsnum").innerHTML=endnum; 	document.getElementById("count").value=endnum; 	@if(proinfo.getPostfee()>0){ 		document.getElementById("postfee").innerHTML='￥'+getWeightfee(endnum); 	} 	 	 	var p=document.getElementById("price").value; 	var ps=0; 	@if(proinfo.getPostfee()>0){ 		ps=document.getElementById("postfee").innerHTML.replace("￥","").trim(); 	} 	 	if(limitcount>1) 		$("#cut_class").attr("class","ico_number_cut ico_number_cut_h"); 	@if(proinfo.getPostfee()>0){ 	document.getElementById("totalprice").innerHTML="￥"+(p*endnum-0+(ps-0)).toFixed(2); 	} 	document.getElementById("hjprice").innerHTML="￥"+(p*endnum-0+(ps-0)).toFixed(2); 	 } function parsle(){ 	var nums=document.getElementById("count").value; 	 	var endnum=nums-1; 	if(endnum<=1){ 		endnum=1; 		$("#cut_class").attr("class","ico_number_cut");	 	} 	if(limitcount>1){ 		$("#add_class").attr("class","ico_number_add"); 	} 	document.getElementById("parsnum").innerHTML=endnum; 	document.getElementById("count").value=endnum; 	@if(proinfo.getPostfee()>0){ 		document.getElementById("postfee").innerHTML='￥'+getWeightfee(endnum); 	} 	var p=document.getElementById("price").value; 	 	var ps=0; 	@if(proinfo.getPostfee()>0){ 		ps=document.getElementById("postfee").innerHTML.replace("￥","").trim(); 	} 	 	@if(proinfo.getPostfee()>0){ 	document.getElementById("totalprice").innerHTML="￥"+(p*endnum-0+(ps-0)).toFixed(2); 	} 	document.getElementById("hjprice").innerHTML="￥"+(p*endnum-0+(ps-0)).toFixed(2); }   function getWeightfee(nums){	 var refee=@proinfo.getWeight()*nums*1000;	 if(refee>500){		 var wf=@proinfo.getFromobj().getFee()+((@proinfo.getWeight()*nums*1000-500)/100)*@proinfo.getFromobj().getAddfee();		 var weightfee=Math.round(wf);//Math.floor(wf);		 //alert(weightfee);		 return weightfee;	 }	 else		 return @proinfo.getFromobj().getFee(); }  //--></script><script>var checkisimg=false;var imgcheck="";function setDivCenter(){  		if ($("#phonereg").val().match(/^((1[0-9]{1})+\d{9})$/)) {		/*		 $.ajax({	            type:"POST",	            url:"/H5/checkimgVerify",	            data:{phone:$("#phonereg").val()},	            datatype: "json",//"xml", "html", "script", "json", "jsonp", "text".	            //在请求之前调用的函数	            beforeSend:function(){},	            success:function(data){    	            		          		if(data.status=="2"){	          			checkisimg=true;	          			verifySMS();	          		}else if(data.status=="1"){	          			showDiv();	          		}else{	          			_alert(data.msg);	          		}	            }   ,	            complete: function(XMLHttpRequest, textStatus){	            },	            error: function(){	                //请求出错处理	                _alert("发送失败!");	            }        	         	});   		*/		verifySMS();	}	else{   	 _alert("请输入正确的手机号!");			//document.getElementById("phone").focus();			return false;    }}function showDiv(){	document.getElementById("imgtmp").src=encodeURI("@routes.Application.imageValidate?temp="+(new Date().getTime().toString(36))+"\"");		var windowWidth = document.documentElement.clientWidth;   		 var windowHeight = document.documentElement.clientHeight;   		 var popupHeight = $("#showdiv").height();   		 var popupWidth = $("#showdiv").width();    	    var top = ($(window).height() - $("#showdiv").height())/2;   	    var left = ($(window).width() - $("#showdiv").width())/2;   	    var scrollTop = $(document).scrollTop();   	    var scrollLeft = $(document).scrollLeft();	    $("#showdiv").css({  	    	  "position": "absolute",   	    	  "top": (windowHeight-popupHeight)/2+$(document).scrollTop(),   	    	  "left": (windowWidth-popupWidth)/2   	    	 });   	   	    document.getElementById("showdiv").style.display="";}function closeDiv(){		imgcheck=document.getElementById("imgh").value;	document.getElementById("imgh").value="";		if(imgcheck.length<4){		_alert("请输入图形验证码")			}else{		//document.getElementById("sendsms").onclick=function(){verifySMS();};		document.getElementById("imgcheck").value=imgcheck;		document.getElementById("showdiv").style.display="none";		verifySMS();	}}		var flag='';	 var reg = /^1\d{10}$/g; 	var miao = 60;    function verifySMS(){        	//alert(iswx);    	    	//if($("#imgcheck").val().length==4)		//	checkisimg=true;    			//if(bw==true)			checkisimg=true;    	miao=60;    	var iswx="0";    	if(bw==true)    		iswx="1";    	    	var pho=document.getElementById("phonereg").value;      	var imc=document.getElementById("imgcheck").value;    	if ($("#phonereg").val().match(/^((1[0-9]{1})+\d{9})$/)) {    		if(checkisimg==true){	    		time_op();	    		 $.ajax({	            //提交数据的类型 POST GET	            type:"POST",	            //提交的网址	            url:"/H5/userVerify",	            //提交的数据	            data:{uid:"@usr.getUid()",phone:pho,reg:"0",imgcheck:imc,wx:iswx},	            //返回数据的格式	            datatype: "json",//"xml", "html", "script", "json", "jsonp", "text".	            //在请求之前调用的函数	            beforeSend:function(){},	            //成功返回之后调用的函数            	            success:function(data){                           	          		if(data.status=="1"){	          			_alert("验证码已成功发送!");	          		}else{	          			_alert(data.msg);	          		}	            }   ,	            //调用执行后调用的函数	            complete: function(XMLHttpRequest, textStatus){	            },	            //调用出错执行的函数	            error: function(){	                //请求出错处理	                _alert("发送失败!");	            }        	         	});       		}else{    			_alert("请输入图形验证码!");				return false;    		}         }         else{        	 _alert("请输入正确的手机号!");   			//document.getElementById("phone").focus();   			return false;         }    }    	function time_op() {			miao--;		if(miao>0){			document.getElementById("sendsms").innerHTML = miao+"秒";			document.getElementById("sendsms").onclick="";		}		else		{				//$("#sendsms").attr("onclick","verifySMS()");			document.getElementById("sendsms").onclick=function(){setDivCenter();};			document.getElementById("sendsms").innerHTML = "重新发送";		}		if(miao>0){			setTimeout("time_op()", "1000");		}	}			function checkuser(){    	var pho=document.getElementById("phonereg").value;  	    	//alert(pho);    	var ver=document.getElementById("verify_sms").value;    	var suc=true;    	    	if (!$("#phonereg").val().match(/^1\d{10}$/g)) {    		_alert("请输入正确的手机号");         	//document.getElementById("phone").focus();    		suc=false;    	}    	else{	    	if(ver.length<1){	    			    		suc=false;	    		_alert("请输入验证码")	    		//document.getElementById("verify_sms").focus();	    	}    	}    	    	if(suc){    $.ajax({            //提交数据的类型 POST GET            type:"POST",            //提交的网址            url:"/sheSaid/reguser",            //提交的数据            data:{uid:'@usr.getUid()',verify_sms:ver,phone:pho,unionid:'@usr.getUnionid()',openid:'@usr.getOpenId()',mcode:'H5'},            //返回数据的格式            datatype: "json",//"xml", "html", "script", "json", "jsonp", "text"            //在请求之前调用的函数            beforeSend:function(){},            //成功返回之后调用的函数                        success:function(data){          		if(data.status=="1"){          			//alert("注册成功!");             			checkuserid=data.userid;          			addressid=data.aid;          			document.getElementById("uid").value=checkuserid          			document.getElementById("onsubreg").onclick=function(){submito();};          			//saveeditaddress();          			//if(addressid>0)          			submito();          			          			document.getElementById("showlogin").style.display="none";           		}else{          			_alert(data.msg);          		}            }   ,            //调用执行后调用的函数            complete: function(XMLHttpRequest, textStatus){            },            //调用出错执行的函数            error: function(){                //请求出错处理                _alert("请输入正确的验证码!");            }                 });   	         }    }		function saveeditaddress(){			// alert(checkuserid);			checkaddress();			if(asuc){			 $.ajax({		            type:"POST",		            url:"/H5/saveaddress",		            data:{aid:addressid,uid:checkuserid,Name:document.getElementById("Name").value,phone:document.getElementById("phone").value,address:document.getElementById("address").value,city_dummy:document.getElementById("city_dummy").value,cardid:document.getElementById("cardId").value,pids:'@proinfo.getPid()'},		            datatype: "json",//"xml", "html", "script", "json", "jsonp", "text".		            beforeSend:function(){},  			           success:function(data){	        	   			         	if(data.status=="1"){				         		//alert("ok"+data.aid);			         		addressid=data.aid;				         }else{				        	 asuc=false;				        	_alert(data.msg); 				         }			           },				       complete: function(XMLHttpRequest, textStatus){				       },				      error: function(){				    	  asuc=false;				        _alert("提示请检查一下网络!");		      				      } 				 });			}	}</script> }