@(proinfo:Product)(user:User)(commlist:List[Comment])(daiyanid:Long)(pdlist:List[ProductDetail])(sign:WxSign)(shareType:String)(cartcount:Int)(usr:User)(flg:String)(endorse:Endorsement)(sta:String)(addrSign:WxSign)(appid:String)(directurl:String)(wxtoken:String)@views.html.sheSaid.main{<title>商品详情</title><script src="@assets.CdnAssets.urlForAPIPublic("javascripts/sheSaidJs/count.js")"></script><script>var orip;var cn="daiyan";@if(user.getGid()==4){	cn="daiyanshanghu";}var counturl = location.href.split('#')[0];function adddycount(){	jQuery(function($){		var url = 'http://chaxun.1616.net/s.php?type=ip&output=json&callback=?&_='+Math.random(); 		$.getJSON(url, function(data){				//添加统计			addcountwxdetail(data.Ip,counturl,cn,'@usr.getUnionid()','@daiyanid');		});	});}adddycount();</script><style>			.certificates{				padding:6px 10px 10px;				}		 	.certificates b{				color:#ff314e;								font-size:12px;				font-weight:400;							}			.certificates p,.certificates input{				color:#303030;				font-size:13px;				line-height:28px;				border-radius:3px;				background:#e4e4e4;				padding:0 2%;				width:96%;				border:none;								}					.login-wrap{				position:absolute;				top:50%;				left:20px;				right:20px;				margin:-160px 0 0 0;				border-radius:6px;				background:#fff;				padding:30px;				box-shadow:0 0 3px #cacacd;						}			.login-wrap h2{				display:block;				text-align:center;				font-size:16px;				line-height:22px;				}				.login{				border-bottom:0;				}					.transparent{		      position: fixed;		      top:0;		      left:0;		      right:0;		      bottom:0;		      background:rgba(0,0,0,.5);		      }	  		  .tariff-tit{			  color:#303030;			  line-height:18px;			  }          .parameter li p.tariff-txt{			  background:none;			  text-indent: 0;			  font-size:15px;			  margin-left:50px;			  line-height:20px;			  color:#a8aaae;			  }		  .parameter span.color{			  color:#ff374d;			  }  		  .ico-shop{			  float:left;			  width:35px;			  height:35px;			  background:url(@assets.CdnAssets.urlForAPIPublic("images/H5/3ico-1.png")) no-repeat center top;              background-size:35px 35px;			  position:relative; 			  }			  .ico-shop b{			  position:absolute;			  top:-10px;			  right:-4px;			  color:#ff314e;			  }	  		  .btn-shop p{		  			  margin-left:35px;			  text-align: right;			  }		  .btn-shop a.btn_finish{			  width:45%;			  margin-left:2%;			  }	  			.btn-shop a.btn-w95{		     width:100%;		     position:relative;		     left:-17px;		     margin:0;		     }  		     			   /*需要整合的样式*/            .transparent {                position: fixed;                top: 0;                left: 0;                right: 0;                bottom: 0;                background: rgba(0,0,0,.5);            }  		   /*新加样式*/	                      .pup-buy-goods{                background:#fff;                overflow:hidden;                position: fixed;                bottom: 0;                left: 0;                right: 0;            }            .pup-buy-goods .product{                overflow:hidden;                                position:relative;                padding-right: 40px;            }            .pup-product-standard{                overflow:hidden;                padding: 5px 10px 10px;            }            .pup-product-standard-cont a{                display: inline-block;                line-height: 30px;                padding: 0 18px;                border:1px solid #85888d;                border-radius: 3px;                margin: 6px 12px 6px 0;            }             .pup-product-standard-cont a.active{                border:1px solid #ff314e;                color: #ff314e;            }            .pup-product-number{                margin-top: 14px;            }            .pup-product-number em{                float: left;                line-height: 28px;            }            .pup-product-number i{                margin: 0 20px;            }            .pop-goods-close{                position:absolute;                top:20px;                right:10px;                width:20px;                height:14px;                text-indent: -9999px;                background:url(@assets.CdnAssets.urlForAPIPublic("images/H5/3ico.png")) no-repeat center top;                background-size:20px 150px;                            }	</style>}{<div class="container">@if(endorse.getGid().toInt==6){		<div class="nav-top">               <p>商品详情</p>               <i class="ico-return" onclick="javascript:history.back();"></i>               <i class="ico-basket" onclick="javascript:window.location.href='@assets.CdnAssets.H5_SHOPPING_URL(endorse.getUserId().toString)'"></i>         </div>}<input type="hidden" id="flg" value="@flg" />           <div class="goods_top goods_top_bg"@if(endorse.getGid().toInt==6){ style="display:none"}>			 <img src="@assets.CdnAssets.urlForAPIPublic("images/sheSaidImages/hi.gif")">              <p><em>嗨个购  与你一起买世界</em></p>              <a href="http://dwz.cn/BDTux" class="btn btn_that">立即打开</a>           </div>                 <div class="goods_info">              <div class="goods_info_img">                 <img src="@proinfo.getListpic()">                 <em></em>              </div>              <div class="goods_info_name">                <h2>@Html(proinfo.getTitle())</h2>                <div><span><b>@if(proinfo.getEndorsementPrice().toInt<proinfo.getEndorsementPrice()){@proinfo.getEndorsementPrice()}else{@proinfo.getEndorsementPrice().toInt}</b>元<s>@proinfo.getRmbprice().toInt 元</s></span>                <em><a href="javsscript:;">@proinfo.getExtcode()折</a>@if(proinfo.getNationalFlag()!=null){<img src="@proinfo.getNationalFlag()" alt="">}</em></div>              </div>              <ul class="parameter">                <li>                   <p>@Html(proinfo.getSubtitle())</p>                </li>                <li>                  <span>由@proinfo.getFromobj().getName()发货</span>                  <em class="shipper"><img src="@proinfo.getFromobj().getImg()" alt=""></em>                </li>                <li>                  <span>物流：<b>@proinfo.getWayremark()@if(proinfo.getPostfee()==0){包邮}@if(proinfo.getPostfee()>0){￥@proinfo.getPostfee()}</b></span>                  <em>重量：<b>@proinfo.getWeight()Kg</b></em>                </li>                <li>                  <span>库存：<b>@proinfo.getNstock()</b></span>                </li>              </ul>              <div class="brand">                 <a href="http://ht.neolix.cn/www/wap/index.html"><img src="@assets.CdnAssets.urlForAPIPublic("images/sheSaidImages/brand.jpg")"></a>              </div>                         </div>           <div class="comment">               <h2>宝贝评价（@if(commlist!=null){@commlist.size}）</h2>               <ul class="comment_info">				@for(co <- commlist){                  <li class="comment_info_h">                      <span><img src="@co.getHeadIcon()"><em>@co.getNickname()</em></span>                      <p>@co.getContent()</p>                  </li>				}           </ul>           </div>           <div class="h5">              <!---->              <div class="j_product">@if(pdlist!=null){                  <div class="j_product_title">                      <p class="f20">                          Details                          <span>                          </span>                      </p>                      <b>                          商品详情                      </b>                  </div>		@for(pdt <- pdlist){			@if(pdt.getPramlist()==null){                  <div class="j_productDetails">                      @Html(pdt.getDetail())                  </div>            }            @if(pdt.getPramlist()!=null){                  <div class="j_product_title">                      <p class="f20">                          Parameters                          <span>                          </span>                      </p>                      <b>                          商品参数                      </b>                  </div>                  <div class="j_productDetails">                  </div>				                  <ul class="j_product_list">					@for(dd <- pdt.getPramlist()){                      <li>                          @dd.getKey()：                          <span class="fr">                              @dd.getVal()                          </span>                      </li>					}                  </ul>				}			}		}              </div>              </div>			<div class="cont goods_pay fixed">				<div class="btn-shop">						@if(sta=="11"){<i class="ico-shop" onclick="gocart()" id="showcart" name="showcart">@if(cartcount>0){<b>@cartcount</b>}</i>}                  <p>                  	@if(sta=="11"){<label id="innertxtcart" name="innertxtcart" style="display:"><a href="javascript:;" onclick="openorder()" class="btn btn_finish">加入购物车</a></label>}              		<label id="innertxt" name="innertxt">@if(sta=="1" || sta=="11"){<a href="javascript:;" onclick="addordercount()" class="btn btn_finish@if(sta=="1"){ btn-w95}">立即购买</a>}else{<a href="javascript:;" onclick="xy()" class="btn btn_finish btn-w95">抢光了别灰心，点我抢更多好物</a>}</label> 				</p>				</div>           </div>        </div>        <a href="#" class="ico_top"></a>  <!-- 登录区 --><div class="transparent" id="showlogin" style="z-index:3000;display:none"><div class="container" id="showlogin" onclick=""><div class="login-wrap">	<h2>                  验证手机号<br>                  便于您按时收货    </h2>	<div class="login">		<form name="form1" id="form1" method="post" action="/api/checkUserVerify">		<input type="hidden" id="openid" name="openid" value="@usr.getOpenId()"/>		<input type="hidden" id="unionid" name="unionid" value="@usr.getUnionid()"/>		<input type="hidden" id="uid" name="uid" value="@usr.getUid()" />		<div class="input-wrap input-wrap-b">			<input type="text" id="phonereg" name="phonereg" class="input tel" placeholder="手机号">		</div>		<div class="input-wrap">			<input type="hidden" id="imgcheck" name="imgcheck" />			<input type="text" id="verify_sms" name="verify_sms" class="input letter" placeholder="短信验证码">			<a href="#" class="btn btn_code"><span id="sendsms" onclick="setDivCenter()">发送验证码</span></a>		</div>		</form>	</div>	<div class="protocol">		<p>			<i class="new_check"></i><a href="http://ht.neolix.cn/www/service/agreement.html">嗨个购用户协议</a>		</p>		<p>			<a href="#" class="btn btn_finish" onclick="checkuser()">完成</a>		</p>	</div>	<a href="javascript:;" class="pop-pay-close" onclick="closeshowlogin()"></a></div>	</div></div><!-- 登录区结束 -->   <!-- 发送验证码 --><div class="pop-code" id="showdiv" style="display:none">           <section>               <p>                 <img src='@assets.CdnAssets.urlForAPIPublic("images/H5/ico.png")' class="pop-code-ico"><br>                 请先输入图形上的字符               </p>               <div>                  <input type="text" id="imgh" name="imgh" class="pop-code-input" placeholder="输入图形验证码" />                  <img id="imgtmp" border="0" alt="点击图片可刷新" class="fr" style="margin-top:3px;*margin-top:-20px;" onclick="this.src='@routes.Application.imageValidate?temp='+ (new Date().getTime().toString(36));" src="@routes.Application.imageValidate?temp=h68w3wf2" id="validateImage"  />               </div>               <p onclick="closeDiv()">                  <a href="javascript:;" class="btn btn_finish">完成</a>               </p>           </section>        </div><!-- 发送验证码结束 -->         }{ <script type="text/javascript"><!--var ua = window.navigator.userAgent.toLowerCase();var bw=false;if(ua.match(/MicroMessenger/i) == 'micromessenger'){	bw=true;	WeixinJSBridge.call('showOptionMenu');}else{	bw=false;}var iswxx="";if(bw)	iswxx="1";	var kc='@proinfo.getNstock()';var status='@proinfo.getStatus()';//alert(status);@if(sta=="1" || sta=="11"){	var ua = window.navigator.userAgent.toLowerCase();	if(ua.match(/MicroMessenger/i) == 'micromessenger'){		//alert("true");		@if(usr.getUid<1){						@if(sta=="1"){				//document.getElementById("innertxt").innnerHTML="/sheSaid/wxauth?uid=@user.getUid()&pid=@proinfo.getPid()&daiyanid=@daiyanid&shareType=@shareType' class='btn btn_finish btn-w95'>立即购买</a>";								document.getElementById("innertxt").innerHTML="<a href='javascript:;' class='btn btn_finish btn-w95' onclick='gowx()' >立即购买</a>";			}		}	}}	//0元及新人购买@if(sta=="0" || sta=="4"){	document.getElementById("innertxt").innerHTML="<a href='#' onclick='xy()' class='btn btn_finish btn-w95'>抢光了别灰心，点我抢更多好物</a>";}//	alert("ok");//alert(document.getElementById("innertxt").innerHTML);@if(sta=="2"){	//许愿/api/product_wish		document.getElementById("innertxt").innerHTML="<a href='#' onclick='xy()' class='btn btn_finish btn-w95'>抢光了别灰心，点我抢更多好物</a>";}@if(sta=="3"){	//定时抢//及预售	document.getElementById("innertxt").innerHTML="<a href='#' onclick='xy()' class='btn btn_finish btn-w95'>准备开抢中</a>";}var checkisimg=false;var imgcheck="";var flag='';var reg = /^1\d{10}$/g; var miao = 60;var ua = window.navigator.userAgent.toLowerCase();var bw=false;var tempuid='@usr.getUid()';if(ua.match(/MicroMessenger/i) == 'micromessenger'){	bw=true;}@if(sta=="11"){	function gocart(){		if(bw==true){			@if(usr.getOpenId()!=""){					window.location.href="/sheSaid/ordercart?eid=@daiyanid";			}else{					window.location.href="/sheSaid/wxauthcart?uid=@user.getUid()&pid=@proinfo.getPid()&daiyanid=@daiyanid&shareType=@shareType&flg=orderlist&w=1";			}		}else{			_alert("请使用微信购买");		}	}}function setDivCenter(){  		if ($("#phonereg").val().match(/^((1[0-9]{1})+\d{9})$/)) {		verifySMS();	}	else{   	 _alert("请输入正确的手机号!");			//document.getElementById("phone").focus();			return false;    }}/*关闭登录窗口层*/function closeshowlogin(){	document.getElementById("showlogin").style.display="none";}/*发送短信验证码*/function verifySMS(){    	//alert(iswx);		//if($("#imgcheck").val().length==4)	//	checkisimg=true;		//if(bw==true)	checkisimg=true;	miao=60;	var iswx="0";	if(bw==true)		iswx="1";		var pho=document.getElementById("phonereg").value;  	var imc=document.getElementById("imgcheck").value;	if ($("#phonereg").val().match(/^((1[0-9]{1})+\d{9})$/)) {		if(checkisimg==true){    		time_op();    		 $.ajax({            type:"POST",            url:"/H5/userVerify",            data:{uid:"@usr.getUid()",phone:pho,reg:"0",imgcheck:imc,wx:iswx},            datatype: "json",//"xml", "html", "script", "json", "jsonp", "text".            beforeSend:function(){},            success:function(data){                                     		if(data.status=="1"){          			_alert("验证码已成功发送!");          		}else{          			_alert(data.msg);          		}            }   ,            complete: function(XMLHttpRequest, textStatus){            },            error: function(){                _alert("发送失败!");            }                 	});   		}else{			_alert("请输入图形验证码!");			return false;		}     }     else{    	 _alert("请输入正确的手机号!");			//document.getElementById("phone").focus();			return false;     }}/*验证码发送倒计时*/function time_op() {		miao--;	if(miao>0){		document.getElementById("sendsms").innerHTML = miao+"秒";		document.getElementById("sendsms").onclick="";	}	else	{			//$("#sendsms").attr("onclick","verifySMS()");		document.getElementById("sendsms").onclick=function(){setDivCenter();};		document.getElementById("sendsms").innerHTML = "重新发送";	}	if(miao>0){		setTimeout("time_op()", "1000");	}}/*图形验证码显示区*/function showDiv(){	document.getElementById("imgtmp").src=encodeURI("@routes.Application.imageValidate?temp="+(new Date().getTime().toString(36))+"\"");	var windowWidth = document.documentElement.clientWidth;   	var windowHeight = document.documentElement.clientHeight;   	var popupHeight = $("#showdiv").height();   	var popupWidth = $("#showdiv").width();    	var top = ($(window).height() - $("#showdiv").height())/2;   	var left = ($(window).width() - $("#showdiv").width())/2;   	var scrollTop = $(document).scrollTop();   	var scrollLeft = $(document).scrollLeft();	$("#showdiv").css({  	   	  "position": "absolute",   	   	  "top": (windowHeight-popupHeight)/2+$(document).scrollTop(),   	   	  "left": (windowWidth-popupWidth)/2   	 });   	   	document.getElementById("showdiv").style.display="";}/*图形验证码关闭*/function closeDiv(){		imgcheck=document.getElementById("imgh").value;	document.getElementById("imgh").value="";		if(imgcheck.length<4){		_alert("请输入图形验证码")			}else{		//document.getElementById("sendsms").onclick=function(){verifySMS();};		document.getElementById("imgcheck").value=imgcheck;		document.getElementById("showdiv").style.display="none";		verifySMS();	}}/*检查注册填写项并注册*/function checkuser(){	var pho=document.getElementById("phonereg").value; 	var ver=document.getElementById("verify_sms").value;	var suc=true;		if (!$("#phonereg").val().match(/^1\d{10}$/g)) {		_alert("请输入正确的手机号");		suc=false;	}	else{    	if(ver.length<1){    		suc=false;    		_alert("请输入验证码")    	}	}    		if(suc){	$.ajax({        type:"POST",        url:"/sheSaid/reguser",        data:{uid:'@usr.getUid()',verify_sms:ver,phone:pho,unionid:'@usr.getUnionid()',openid:'@usr.getOpenId()',mcode:'H5'},        datatype: "json",//"xml", "html", "script", "json", "jsonp", "text"        beforeSend:function(){},                success:function(data){      		if(data.status=="1"){      			//注册成功添加购物车         			tempuid=data.uid;      			if(document.getElementById("flg").value=="orderlist"){      				window.location.href="/sheSaid/ordercart";      			}else{      				addcart(data.uid);      			}       		}else{      			_alert(data.msg);      		}        }   ,        complete: function(XMLHttpRequest, textStatus){        },        error: function(){            _alert("请输入正确的验证码!");        }             });   	     }}@if(sta=="11"){	/*添加购物车*/	function addcart(openid){		document.getElementById("showlogin").style.display="none";		var pid='@proinfo.getPid()';		var pcount=1;		addcartact(openid,pid,pcount);	}		/*添加购物车处理*/	function addcartactselect(){		var pid=document.getElementById("ppid").value;		var pcount=document.getElementById("pcount").value;		var openid='@usr.getOpenId()';		addcartact(openid,pid,pcount);	}	/*添加购物车处理*/	function addcartact(openid,pid,cnt){			$.ajax({				type:"POST",				url:"/sheSaid/addCart",				data:{openid:openid,pid:pid,cnt:cnt,eid:'@daiyanid'},				datatype:"json",				beforeSend:function(){},				success:function(datac){					if(datac.status=="1"){											window.location.href="/sheSaid/ordercart?eid=@daiyanid";					}else{						_alert(datac.msg);						window.location.href="/sheSaid/ordercart?eid=@daiyanid";					}				},				complete:function(XZMLZZHttpRequest, textStatus){},				error:function(){					_alert("产品已售磬！");				}			});	}		/*点击购物车*/	function openorder(){		var tempuid='@usr.getUid()';			if(ua.match(/MicroMessenger/i) == 'micromessenger'){						//if(tempuid.length<1 || tempuid=='0'){				@if(usr.getOpenId()!=""){					addcart('@usr.getOpenId()');					//document.getElementById("showlogin").style.display="";				}else{					window.location.href="/sheSaid/wxauthcart?uid=@user.getUid()&pid=@proinfo.getPid()&daiyanid=@daiyanid&shareType=@shareType&flg=voke";				}			//}else{			//	addcart('@usr.getUid()');			//}				}else{			//if(tempuid.length<1 || tempuid=='0'){			//	document.getElementById("showlogin").style.display="";			//}else{			//	addcart('@usr.getUid()');			//}			_alert("请使用微信购买");		}	}	@if(usr.getOpenId()!="" && usr.getUid()==0){//		openorder();	}}//--></script><script>function gowx(){	@if(wxtoken=="" || addrSign==null){	var u="@directurl";//encodeURI("http://ht2.neolix.cn/H5/order_address?pid=@proinfo.getPid()&daiyanid=@daiyanid");	window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=@appid&redirect_uri="+u+"&response_type=code&scope=snsapi_base&state=123&connect_redirect=1#wechat_redirect";	}else{		window.location.href="/sheSaid/order?pid=@proinfo.getPid()&daiyanid=@daiyanid@if(addrSign!=null){&code=@addrSign.getCode()&state=@addrSign.getState()}";	}}function xy(){	//var counturl = location.href.split('#')[0];	//添加统计	addcountdy('','http://dwz.cn/BDTux','0','1','daiyan','','@daiyanid');	setTimeout(function(){		window.location.href="http://dwz.cn/BDTux";		},2000);         	}	 function addordercount(){	@if(sta=="1" || sta=="11"){	jQuery(function($){		var url = 'http://chaxun.1616.net/s.php?type=ip&output=json&callback=?&_='+Math.random(); 		$.getJSON(url, function(data){			orip=data.Ip; 			//添加统计			addcountdy(data.Ip,counturl,'1',iswxx,cn+'onclick','@user.getUid()','@daiyanid');		});	});		setTimeout(function(data){		if(ua.match(/MicroMessenger/i) == 'micromessenger'){			gowx();		}else{			window.location.href="/sheSaid/order?pid=@proinfo.getPid()&daiyanid=@daiyanid";		}	},1000);	}else{		xy();	}}  </script><script src="@assets.CdnAssets.urlForAPIPublic("javascripts/sheSaidJs/alert.js")"></script>@if(sign!=null){<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script><script>var surl='@sign.getShareurl()'.replace(new RegExp("amp;","gm"),"&");//alert(surl);var linkurl=location.href.split('#')[0];  wx.config({    debug: false,    appId: '@sign.getAppId()',    timestamp: '@sign.getTimstr()',    nonceStr: '@sign.getNostr()',    signature: '@sign.getSign()',    jsApiList: ['checkJsApi',                'onMenuShareTimeline',                'onMenuShareAppMessage'    ]  });	wx.ready(function () {    // 1 判断当前版本是否支持指定 JS 接口，支持批量判断		wx.checkJsApi({		  jsApiList: [			'getNetworkType',			'previewImage'		  ],		  success: function (res) {			//alert(JSON.stringify(res));		  }		});		wx.onMenuShareTimeline({			title: '@sign.getSharetitle()', // 分享标题		    link: surl, // 分享链接		    imgUrl: '@sign.getShareimg()', // 分享图标		    success: function () { 		        // 用户确认分享后执行的回调函数		    },		    cancel: function () { 		        // 用户取消分享后执行的回调函数		    }		});		wx.onMenuShareAppMessage({			title: '@sign.getSharetitle()',			  desc: '@sign.getSharecontent()',			  link: surl,			  imgUrl: '@sign.getShareimg()',			  success: function (res) {				//alert('已分享');			  },			  cancel: function (res) {				//alert('已取消');			  }		  });		  });  wx.error(function (res){		//alert(res.errMsg);  });</script>}}